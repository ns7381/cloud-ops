define(["jquery"],function(a){a.History?window.console.warn("$.History has already been defined..."):(a.History={options:{debug:!1},state:"",$window:null,$iframe:null,handlers:{generic:[],specific:{}},extractHash:function(a){var b=a.replace(/^[^#]*#/,"").replace(/^#+|#+$/,"");return b},getState:function(){var b=a.History;return b.state},setState:function(b){var c=a.History;return b=c.extractHash(b),c.state=b,c.state},getHash:function(){var b=a.History,c=b.extractHash(window.location.hash||location.hash);return c},setHash:function(b){var c=a.History;return b=c.extractHash(b),"undefined"!=typeof window.location.hash?window.location.hash!==b&&(window.location.hash=b):location.hash!==b&&(location.hash=b),b},go:function(b){var c=a.History;b=c.extractHash(b);var d=c.getHash(),e=c.getState();return b!==d?c.setHash(b):(b!==e&&c.setState(b),c.trigger()),!0},hashchange:function(b){var c=a.History,d=c.getHash();return c.go(d),!0},bind:function(b,c){var d=a.History;return c?("undefined"==typeof d.handlers.specific[b]&&(d.handlers.specific[b]=[]),d.handlers.specific[b].push(c)):(c=b,d.handlers.generic.push(c)),!0},trigger:function(b){var c=a.History;"undefined"==typeof b&&(b=c.getState());var d,e,f,g;if("undefined"!=typeof c.handlers.specific[b])for(g=c.handlers.specific[b],d=0,e=g.length;d<e;++d)(f=g[d])(b);for(g=c.handlers.generic,d=0,e=g.length;d<e;++d)(f=g[d])(b);return!0},construct:function(){var b=a.History;return a(document).ready(function(){b.domReady()}),!0},configure:function(b){var c=a.History;return c.options=a.extend(c.options,b),!0},domReadied:!1,domReady:function(){var b=a.History;if(!b.domRedied)return b.domRedied=!0,b.$window=a(window),b.$window.bind("hashchange",this.hashchange),setTimeout(b.hashchangeLoader,200),!0},nativeSupport:function(){return"onhashchange"in window&&(void 0===document.documentMode||document.documentMode>7)},hashchangeLoader:function(){var b=a.History,c=b.nativeSupport();if(c){var d=b.getHash();d&&b.$window.trigger("hashchange")}else{var e;if(/msie/.test(window.navigator.userAgent.toLowerCase())){b.$iframe=a('<iframe id="jquery-history-iframe" style="display: none;"></iframe>').prependTo(document.body)[0],b.$iframe.contentWindow.document.open(),b.$iframe.contentWindow.document.close();var f=!1;e=function(){var a=b.getHash(),c=b.getState(),d=b.extractHash(b.$iframe.contentWindow.document.location.hash);c!==a?(f||(b.$iframe.contentWindow.document.open(),b.$iframe.contentWindow.document.close(),b.$iframe.contentWindow.document.location.hash=a),f=!1,b.$window.trigger("hashchange")):c!==d&&(f=!0,b.setHash(d))}}else e=function(){var a=b.getHash(),c=b.getState();c!==a&&b.$window.trigger("hashchange")};setInterval(e,200)}return!0}},a.History.construct())});