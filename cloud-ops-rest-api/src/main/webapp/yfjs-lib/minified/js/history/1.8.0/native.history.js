define(["json"],function(a){var b;return function(a,c){"use strict";if(b=a.History=a.History||{},"undefined"!=typeof b.Adapter)throw new Error("History.js Adapter has already been loaded...");b.Adapter={handlers:{},_uid:1,uid:function(a){return a._uid||(a._uid=b.Adapter._uid++)},bind:function(a,c,d){var e=b.Adapter.uid(a);b.Adapter.handlers[e]=b.Adapter.handlers[e]||{},b.Adapter.handlers[e][c]=b.Adapter.handlers[e][c]||[],b.Adapter.handlers[e][c].push(d),a["on"+c]=function(a,c){return function(d){b.Adapter.trigger(a,c,d)}}(a,c)},trigger:function(a,c,d){d=d||{};var e,f,g=b.Adapter.uid(a);for(b.Adapter.handlers[g]=b.Adapter.handlers[g]||{},b.Adapter.handlers[g][c]=b.Adapter.handlers[g][c]||[],e=0,f=b.Adapter.handlers[g][c].length;e<f;++e)b.Adapter.handlers[g][c][e].apply(this,[d])},extractEventData:function(a,b){var d=b&&b[a]||c;return d},onDomLoad:function(b){var c=a.setTimeout(function(){b()},2e3);a.onload=function(){clearTimeout(c),b()}}},"undefined"!=typeof b.init&&b.init()}(window),function(a,c){"use strict";var d=a.document,e=a.setTimeout||e,f=a.clearTimeout||f,g=a.setInterval||g;if(b=a.History=a.History||{},"undefined"!=typeof b.initHtml4)throw new Error("History.js HTML4 Support has already been loaded...");b.initHtml4=function(){return"undefined"==typeof b.initHtml4.initialized&&(b.initHtml4.initialized=!0,b.enabled=!0,b.savedHashes=[],b.isLastHash=function(a){var c,d=b.getHashByIndex();return c=a===d},b.isHashEqual=function(a,b){return a=encodeURIComponent(a).replace(/%25/g,"%"),b=encodeURIComponent(b).replace(/%25/g,"%"),a===b},b.saveHash=function(a){return!b.isLastHash(a)&&(b.savedHashes.push(a),!0)},b.getHashByIndex=function(a){var c=null;return c="undefined"==typeof a?b.savedHashes[b.savedHashes.length-1]:a<0?b.savedHashes[b.savedHashes.length+a]:b.savedHashes[a]},b.discardedHashes={},b.discardedStates={},b.discardState=function(a,c,d){var e,f=b.getHashByState(a);return e={discardedState:a,backState:d,forwardState:c},b.discardedStates[f]=e,!0},b.discardHash=function(a,c,d){var e={discardedHash:a,backState:d,forwardState:c};return b.discardedHashes[a]=e,!0},b.discardedState=function(a){var c,d=b.getHashByState(a);return c=b.discardedStates[d]||!1},b.discardedHash=function(a){var c=b.discardedHashes[a]||!1;return c},b.recycleState=function(a){var c=b.getHashByState(a);return b.discardedState(a)&&delete b.discardedStates[c],!0},b.emulated.hashChange&&(b.hashChangeInit=function(){b.checkerFunction=null;var c,e,f,h,i="",j=Boolean(b.getHash());return b.isInternetExplorer()?(c="historyjs-iframe",e=d.createElement("iframe"),e.setAttribute("id",c),e.setAttribute("src","#"),e.style.display="none",d.body.appendChild(e),e.contentWindow.document.open(),e.contentWindow.document.close(),f="",h=!1,b.checkerFunction=function(){if(h)return!1;h=!0;var c=b.getHash(),d=b.getHash(e.contentWindow.document);return c!==i?(i=c,d!==c&&(f=d=c,e.contentWindow.document.open(),e.contentWindow.document.close(),e.contentWindow.document.location.hash=b.escapeHash(c)),b.Adapter.trigger(a,"hashchange")):d!==f&&(f=d,j&&""===d?b.back():b.setHash(d,!1)),h=!1,!0}):b.checkerFunction=function(){var c=b.getHash()||"";return c!==i&&(i=c,b.Adapter.trigger(a,"hashchange")),!0},b.intervalList.push(g(b.checkerFunction,b.options.hashChangeInterval)),!0},b.Adapter.onDomLoad(b.hashChangeInit)),b.emulated.pushState&&(b.onHashChange=function(c){var d,e=c&&c.newURL||b.getLocationHref(),f=b.getHashByUrl(e),g=null,h=null;return b.isLastHash(f)?(b.busy(!1),!1):(b.doubleCheckComplete(),b.saveHash(f),f&&b.isTraditionalAnchor(f)?(b.Adapter.trigger(a,"anchorchange"),b.busy(!1),!1):(g=b.extractState(b.getFullUrl(f||b.getLocationHref()),!0),b.isLastSavedState(g)?(b.busy(!1),!1):(h=b.getHashByState(g),(d=b.discardedState(g))?(b.getHashByIndex(-2)===b.getHashByState(d.forwardState)?b.back(!1):b.forward(!1),!1):(b.pushState(g.data,g.title,encodeURI(g.url),!1),!0))))},b.Adapter.bind(a,"hashchange",b.onHashChange),b.pushState=function(c,d,e,f){if(e=encodeURI(e).replace(/%25/g,"%"),b.getHashByUrl(e))throw new Error("History.js does not support states with fragment-identifiers (hashes/anchors).");if(f!==!1&&b.busy())return b.pushQueue({scope:b,callback:b.pushState,args:arguments,queue:f}),!1;b.busy(!0);var g=b.createStateObject(c,d,e),h=b.getHashByState(g),i=b.getState(!1),j=b.getHashByState(i),k=b.getHash(),l=b.expectedStateId==g.id;return b.storeState(g),b.expectedStateId=g.id,b.recycleState(g),b.setTitle(g),h===j?(b.busy(!1),!1):(b.saveState(g),l||b.Adapter.trigger(a,"statechange"),b.isHashEqual(h,k)||b.isHashEqual(h,b.getShortUrl(b.getLocationHref()))||b.setHash(h,!1),b.busy(!1),!0)},b.replaceState=function(c,d,e,f){if(e=encodeURI(e).replace(/%25/g,"%"),b.getHashByUrl(e))throw new Error("History.js does not support states with fragment-identifiers (hashes/anchors).");if(f!==!1&&b.busy())return b.pushQueue({scope:b,callback:b.replaceState,args:arguments,queue:f}),!1;b.busy(!0);var g=b.createStateObject(c,d,e),h=b.getHashByState(g),i=b.getState(!1),j=b.getHashByState(i),k=b.getStateByIndex(-2);return b.discardState(i,g,k),h===j?(b.storeState(g),b.expectedStateId=g.id,b.recycleState(g),b.setTitle(g),b.saveState(g),b.Adapter.trigger(a,"statechange"),b.busy(!1)):b.pushState(g.data,g.title,g.url,!1),!0}),void(b.emulated.pushState&&b.getHash()&&!b.emulated.hashChange&&b.Adapter.onDomLoad(function(){b.Adapter.trigger(a,"hashchange")})))},"undefined"!=typeof b.init&&b.init()}(window),function(c,d){"use strict";var e=c.console||d,f=c.document,g=c.navigator,h=c.sessionStorage||!1,i=c.setTimeout,j=c.clearTimeout,k=c.setInterval,l=c.clearInterval,m=c.alert;b=c.History=c.History||{};var n=c.history;try{h.setItem("TEST","1"),h.removeItem("TEST")}catch(a){h=!1}if(a.stringify=a.stringify||a.encode,a.parse=a.parse||a.decode,"undefined"!=typeof b.init)throw new Error("History.js Core has already been loaded...");b.init=function(a){return"undefined"!=typeof b.Adapter&&("undefined"!=typeof b.initCore&&b.initCore(),"undefined"!=typeof b.initHtml4&&b.initHtml4(),!0)},b.initCore=function(o){if("undefined"!=typeof b.initCore.initialized)return!1;if(b.initCore.initialized=!0,b.options=b.options||{},b.options.hashChangeInterval=b.options.hashChangeInterval||100,b.options.safariPollInterval=b.options.safariPollInterval||500,b.options.doubleCheckInterval=b.options.doubleCheckInterval||500,b.options.disableSuid=b.options.disableSuid||!1,b.options.storeInterval=b.options.storeInterval||1e3,b.options.busyDelay=b.options.busyDelay||250,b.options.debug=b.options.debug||!1,b.options.initialTitle=b.options.initialTitle||f.title,b.options.html4Mode=b.options.html4Mode||!1,b.options.delayInit=b.options.delayInit||!1,b.intervalList=[],b.clearAllIntervals=function(){var a,c=b.intervalList;if("undefined"!=typeof c&&null!==c){for(a=0;a<c.length;a++)l(c[a]);b.intervalList=null}},b.debug=function(){b.options.debug&&b.log.apply(b,arguments)},b.log=function(){var b,c,d,g,h,i=!("undefined"==typeof e||"undefined"==typeof e.log||"undefined"==typeof e.log.apply),j=f.getElementById("log");for(i?(g=Array.prototype.slice.call(arguments),b=g.shift(),"undefined"!=typeof e.debug?e.debug.apply(e,[b,g]):e.log.apply(e,[b,g])):b="\n"+arguments[0]+"\n",c=1,d=arguments.length;c<d;++c){if(h=arguments[c],"object"==typeof h&&"undefined"!=typeof a)try{h=a.stringify(h)}catch(a){}b+="\n"+h+"\n"}return j?(j.value+=b+"\n-----\n",j.scrollTop=j.scrollHeight-j.clientHeight):i||m(b),!0},b.getInternetExplorerMajorVersion=function(){var a=b.getInternetExplorerMajorVersion.cached="undefined"!=typeof b.getInternetExplorerMajorVersion.cached?b.getInternetExplorerMajorVersion.cached:function(){for(var a=3,b=f.createElement("div"),c=b.getElementsByTagName("i");(b.innerHTML="<!--[if gt IE "+ ++a+"]><i></i><![endif]-->")&&c[0];);return a>4&&a}();return a},b.isInternetExplorer=function(){var a=b.isInternetExplorer.cached="undefined"!=typeof b.isInternetExplorer.cached?b.isInternetExplorer.cached:Boolean(b.getInternetExplorerMajorVersion());return a},b.options.html4Mode?b.emulated={pushState:!0,hashChange:!0}:b.emulated={pushState:!Boolean(c.history&&c.history.pushState&&c.history.replaceState&&!(/ Mobile\/([1-7][a-z]|(8([abcde]|f(1[0-8]))))/i.test(g.userAgent)||/AppleWebKit\/5([0-2]|3[0-2])/i.test(g.userAgent))),hashChange:Boolean(!("onhashchange"in c||"onhashchange"in f)||b.isInternetExplorer()&&b.getInternetExplorerMajorVersion()<8)},b.enabled=!b.emulated.pushState,b.bugs={setHash:Boolean(!b.emulated.pushState&&"Apple Computer, Inc."===g.vendor&&/AppleWebKit\/5([0-2]|3[0-3])/.test(g.userAgent)),safariPoll:Boolean(!b.emulated.pushState&&"Apple Computer, Inc."===g.vendor&&/AppleWebKit\/5([0-2]|3[0-3])/.test(g.userAgent)),ieDoubleCheck:Boolean(b.isInternetExplorer()&&b.getInternetExplorerMajorVersion()<8),hashEscape:Boolean(b.isInternetExplorer()&&b.getInternetExplorerMajorVersion()<7)},b.isEmptyObject=function(a){for(var b in a)if(a.hasOwnProperty(b))return!1;return!0},b.cloneObject=function(b){var c,d;return b?(c=a.stringify(b),d=a.parse(c)):d={},d},b.getRootUrl=function(){var a=f.location.protocol+"//"+(f.location.hostname||f.location.host);return f.location.port&&(a+=":"+f.location.port),a+="/"},b.getBaseHref=function(){var a=f.getElementsByTagName("base"),b=null,c="";return 1===a.length&&(b=a[0],c=b.href.replace(/[^\/]+$/,"")),c=c.replace(/\/+$/,""),c&&(c+="/"),c},b.getBaseUrl=function(){var a=b.getBaseHref()||b.getBasePageUrl()||b.getRootUrl();return a},b.getPageUrl=function(){var a,c=b.getState(!1,!1),d=(c||{}).url||b.getLocationHref();return a=d.replace(/\/+$/,"").replace(/[^\/]+$/,function(a,b,c){return/\./.test(a)?a:a+"/"})},b.getBasePageUrl=function(){var a=b.getLocationHref().replace(/[#\?].*/,"").replace(/[^\/]+$/,function(a,b,c){return/[^\/]$/.test(a)?"":a}).replace(/\/+$/,"")+"/";return a},b.getFullUrl=function(a,c){var d=a,e=a.substring(0,1);return c="undefined"==typeof c||c,/[a-z]+\:\/\//.test(a)||(d="/"===e?b.getRootUrl()+a.replace(/^\/+/,""):"#"===e?b.getPageUrl().replace(/#.*/,"")+a:"?"===e?b.getPageUrl().replace(/[\?#].*/,"")+a:c?b.getBaseUrl()+a.replace(/^(\.\/)+/,""):b.getBasePageUrl()+a.replace(/^(\.\/)+/,"")),d.replace(/\#$/,"")},b.getShortUrl=function(a){var c=a,d=b.getBaseUrl(),e=b.getRootUrl();return b.emulated.pushState&&(c=c.replace(d,/\/$/.test(d)?"/":"")),c=c.replace(e,"/"),b.isTraditionalAnchor(c)&&(c="./"+c),c=c.replace(/^(\.\/)+/g,"./").replace(/\#$/,"")},b.getLocationHref=function(a){return a=a||f,a.URL===a.location.href?a.location.href:a.location.href===decodeURIComponent(a.URL)?a.URL:a.location.hash&&decodeURIComponent(a.location.href.replace(/^[^#]+/,""))===a.location.hash?a.location.href:a.URL.indexOf("#")==-1&&a.location.href.indexOf("#")!=-1?a.location.href:a.URL||a.location.href},b.store={},b.idToState=b.idToState||{},b.stateToId=b.stateToId||{},b.urlToId=b.urlToId||{},b.storedStates=b.storedStates||[],b.savedStates=b.savedStates||[],b.normalizeStore=function(){b.store.idToState=b.store.idToState||{},b.store.urlToId=b.store.urlToId||{},b.store.stateToId=b.store.stateToId||{}},b.getState=function(a,c){"undefined"==typeof a&&(a=!0),"undefined"==typeof c&&(c=!0);var d=b.getLastSavedState();return!d&&c&&(d=b.createStateObject()),a&&(d=b.cloneObject(d),d.url=d.cleanUrl||d.url),d},b.getIdByState=function(a){var c,d=b.extractId(a.url);if(!d)if(c=b.getStateString(a),"undefined"!=typeof b.stateToId[c])d=b.stateToId[c];else if("undefined"!=typeof b.store.stateToId[c])d=b.store.stateToId[c];else{for(;;)if(d=(new Date).getTime()+String(Math.random()).replace(/\D/g,""),"undefined"==typeof b.idToState[d]&&"undefined"==typeof b.store.idToState[d])break;b.stateToId[c]=d,b.idToState[d]=a}return d},b.normalizeState=function(a){var c,d;return a&&"object"==typeof a||(a={}),"undefined"!=typeof a.normalized?a:(a.data&&"object"==typeof a.data||(a.data={}),c={},c.normalized=!0,c.title=a.title||"",c.url=b.getFullUrl(a.url?a.url:b.getLocationHref()),c.hash=b.getShortUrl(c.url),c.data=b.cloneObject(a.data),c.id=b.getIdByState(c),c.cleanUrl=c.url.replace(/\??\&_suid.*/,""),c.url=c.cleanUrl,d=!b.isEmptyObject(c.data),(c.title||d)&&b.options.disableSuid!==!0&&(c.hash=b.getShortUrl(c.url).replace(/\??\&_suid.*/,""),/\?/.test(c.hash)||(c.hash+="?"),c.hash+="&_suid="+c.id),c.hashedUrl=b.getFullUrl(c.hash),(b.emulated.pushState||b.bugs.safariPoll)&&b.hasUrlDuplicate(c)&&(c.url=c.hashedUrl),c)},b.createStateObject=function(a,c,d){var e={data:a,title:c,url:d};return e=b.normalizeState(e)},b.getStateById=function(a){a=String(a);var c=b.idToState[a]||b.store.idToState[a]||d;return c},b.getStateString=function(c){var d,e,f;return d=b.normalizeState(c),e={data:d.data,title:c.title,url:c.url},f=a.stringify(e)},b.getStateId=function(a){var c,d;return c=b.normalizeState(a),d=c.id},b.getHashByState=function(a){var c,d;return c=b.normalizeState(a),d=c.hash},b.extractId=function(a){var b,c,d,e;return e=a.indexOf("#")!=-1?a.split("#")[0]:a,c=/(.*)\&_suid=([0-9]+)$/.exec(e),d=c?c[1]||a:a,b=c?String(c[2]||""):"",b||!1},b.isTraditionalAnchor=function(a){var b=""!==a&&!/[\/\?\.]/.test(a);return b},b.extractState=function(a,c){var d,e,f=null;return c=c||!1,d=b.extractId(a),d&&(f=b.getStateById(d)),f||(e=b.getFullUrl(a),d=b.getIdByUrl(e)||!1,d&&(f=b.getStateById(d)),f||!c||b.isTraditionalAnchor(a)||(f=b.createStateObject(null,null,e))),f},b.getIdByUrl=function(a){var c=b.urlToId[a]||b.store.urlToId[a]||d;return c},b.getLastSavedState=function(){return b.savedStates[b.savedStates.length-1]||d},b.getLastStoredState=function(){return b.storedStates[b.storedStates.length-1]||d},b.hasUrlDuplicate=function(a){var c,d=!1;return c=b.extractState(a.url),d=c&&c.id!==a.id},b.storeState=function(a){return b.urlToId[a.url]=a.id,b.storedStates.push(b.cloneObject(a)),a},b.isLastSavedState=function(a){var c,d,e,f=!1;return b.savedStates.length&&(c=a.id,d=b.getLastSavedState(),e=d.id,f=c===e),f},b.saveState=function(a){return!b.isLastSavedState(a)&&(b.savedStates.push(b.cloneObject(a)),!0)},b.getStateByIndex=function(a){var c=null;return c="undefined"==typeof a?b.savedStates[b.savedStates.length-1]:a<0?b.savedStates[b.savedStates.length+a]:b.savedStates[a]},b.getCurrentIndex=function(){var a=null;return a=b.savedStates.length<1?0:b.savedStates.length-1},b.getHash=function(a){var c,d=b.getLocationHref(a);return c=b.getHashByUrl(d)},b.unescapeHash=function(a){var c=b.normalizeHash(a);return c=decodeURIComponent(c)},b.normalizeHash=function(a){var b=a.replace(/[^#]*#/,"").replace(/#.*/,"");return b},b.setHash=function(a,c){var d,e;return c!==!1&&b.busy()?(b.pushQueue({scope:b,callback:b.setHash,args:arguments,queue:c}),!1):(b.busy(!0),d=b.extractState(a,!0),d&&!b.emulated.pushState?b.pushState(d.data,d.title,d.url,!1):b.getHash()!==a&&(b.bugs.setHash?(e=b.getPageUrl(),b.pushState(null,null,e+"#"+a,!1)):f.location.hash=a),b)},b.escapeHash=function(a){var d=b.normalizeHash(a);return d=c.encodeURIComponent(d),b.bugs.hashEscape||(d=d.replace(/\%21/g,"!").replace(/\%26/g,"&").replace(/\%3D/g,"=").replace(/\%3F/g,"?")),d},b.getHashByUrl=function(a){var c=String(a).replace(/([^#]*)#?([^#]*)#?(.*)/,"$2");return c=b.unescapeHash(c)},b.setTitle=function(a){var c,d=a.title;d||(c=b.getStateByIndex(0),c&&c.url===a.url&&(d=c.title||b.options.initialTitle));try{f.getElementsByTagName("title")[0].innerHTML=d.replace("<","&lt;").replace(">","&gt;").replace(" & "," &amp; ")}catch(a){}return f.title=d,b},b.queues=[],b.busy=function(a){if("undefined"!=typeof a?b.busy.flag=a:"undefined"==typeof b.busy.flag&&(b.busy.flag=!1),!b.busy.flag){j(b.busy.timeout);var c=function(){var a,d,e;if(!b.busy.flag)for(a=b.queues.length-1;a>=0;--a)d=b.queues[a],0!==d.length&&(e=d.shift(),b.fireQueueItem(e),b.busy.timeout=i(c,b.options.busyDelay))};b.busy.timeout=i(c,b.options.busyDelay)}return b.busy.flag},b.busy.flag=!1,b.fireQueueItem=function(a){return a.callback.apply(a.scope||b,a.args||[])},b.pushQueue=function(a){return b.queues[a.queue||0]=b.queues[a.queue||0]||[],b.queues[a.queue||0].push(a),b},b.queue=function(a,c){return"function"==typeof a&&(a={callback:a}),"undefined"!=typeof c&&(a.queue=c),b.busy()?b.pushQueue(a):b.fireQueueItem(a),b},b.clearQueue=function(){return b.busy.flag=!1,b.queues=[],b},b.stateChanged=!1,b.doubleChecker=!1,b.doubleCheckComplete=function(){return b.stateChanged=!0,b.doubleCheckClear(),b},b.doubleCheckClear=function(){return b.doubleChecker&&(j(b.doubleChecker),b.doubleChecker=!1),b},b.doubleCheck=function(a){return b.stateChanged=!1,b.doubleCheckClear(),b.bugs.ieDoubleCheck&&(b.doubleChecker=i(function(){return b.doubleCheckClear(),b.stateChanged||a(),!0},b.options.doubleCheckInterval)),b},b.safariStatePoll=function(){var a,d=b.extractState(b.getLocationHref());if(!b.isLastSavedState(d))return a=d,a||(a=b.createStateObject()),b.Adapter.trigger(c,"popstate"),b},b.back=function(a){return a!==!1&&b.busy()?(b.pushQueue({scope:b,callback:b.back,args:arguments,queue:a}),!1):(b.busy(!0),b.doubleCheck(function(){b.back(!1)}),n.go(-1),!0)},b.forward=function(a){return a!==!1&&b.busy()?(b.pushQueue({scope:b,callback:b.forward,args:arguments,queue:a}),!1):(b.busy(!0),b.doubleCheck(function(){b.forward(!1)}),n.go(1),!0)},b.go=function(a,c){var d;if(a>0)for(d=1;d<=a;++d)b.forward(c);else{if(!(a<0))throw new Error("History.go: History.go requires a positive or negative integer passed.");for(d=-1;d>=a;--d)b.back(c)}return b},b.emulated.pushState){var p=function(){};b.pushState=b.pushState||p,b.replaceState=b.replaceState||p}else b.onPopState=function(a,d){var e,f,g=!1,h=!1;return b.doubleCheckComplete(),(e=b.getHash())?(f=b.extractState(e||b.getLocationHref(),!0),f?b.replaceState(f.data,f.title,f.url,!1):(b.Adapter.trigger(c,"anchorchange"),b.busy(!1)),b.expectedStateId=!1,!1):(g=b.Adapter.extractEventData("state",a,d)||!1,h=g?b.getStateById(g):b.expectedStateId?b.getStateById(b.expectedStateId):b.extractState(b.getLocationHref()),h||(h=b.createStateObject(null,null,b.getLocationHref())),b.expectedStateId=!1,b.isLastSavedState(h)?(b.busy(!1),!1):(b.storeState(h),b.saveState(h),b.setTitle(h),b.Adapter.trigger(c,"statechange"),b.busy(!1),!0))},b.Adapter.bind(c,"popstate",b.onPopState),b.pushState=function(a,d,e,f){if(b.getHashByUrl(e)&&b.emulated.pushState)throw new Error("History.js does not support states with fragement-identifiers (hashes/anchors).");if(f!==!1&&b.busy())return b.pushQueue({scope:b,callback:b.pushState,args:arguments,queue:f}),!1;b.busy(!0);var g=b.createStateObject(a,d,e);return b.isLastSavedState(g)?b.busy(!1):(b.storeState(g),b.expectedStateId=g.id,n.pushState(g.id,g.title,g.url),b.Adapter.trigger(c,"popstate")),!0},b.replaceState=function(a,d,e,f){if(b.getHashByUrl(e)&&b.emulated.pushState)throw new Error("History.js does not support states with fragement-identifiers (hashes/anchors).");if(f!==!1&&b.busy())return b.pushQueue({scope:b,callback:b.replaceState,args:arguments,queue:f}),!1;b.busy(!0);var g=b.createStateObject(a,d,e);return b.isLastSavedState(g)?b.busy(!1):(b.storeState(g),b.expectedStateId=g.id,n.replaceState(g.id,g.title,g.url),b.Adapter.trigger(c,"popstate")),!0};if(h){try{b.store=a.parse(h.getItem("History.store"))||{}}catch(a){b.store={}}b.normalizeStore()}else b.store={},b.normalizeStore();b.Adapter.bind(c,"unload",b.clearAllIntervals),b.saveState(b.storeState(b.extractState(b.getLocationHref(),!0))),h&&(b.onUnload=function(){var c,d,e;try{c=a.parse(h.getItem("History.store"))||{}}catch(a){c={}}c.idToState=c.idToState||{},c.urlToId=c.urlToId||{},c.stateToId=c.stateToId||{};for(d in b.idToState)b.idToState.hasOwnProperty(d)&&(c.idToState[d]=b.idToState[d]);for(d in b.urlToId)b.urlToId.hasOwnProperty(d)&&(c.urlToId[d]=b.urlToId[d]);for(d in b.stateToId)b.stateToId.hasOwnProperty(d)&&(c.stateToId[d]=b.stateToId[d]);b.store=c,b.normalizeStore(),e=a.stringify(c);try{h.setItem("History.store",e)}catch(a){if(a.code!==DOMException.QUOTA_EXCEEDED_ERR)throw a;h.length&&(h.removeItem("History.store"),h.setItem("History.store",e))}},b.intervalList.push(k(b.onUnload,b.options.storeInterval)),b.Adapter.bind(c,"beforeunload",b.onUnload),b.Adapter.bind(c,"unload",b.onUnload)),b.emulated.pushState||(b.bugs.safariPoll&&b.intervalList.push(k(b.safariStatePoll,b.options.safariPollInterval)),"Apple Computer, Inc."!==g.vendor&&"Mozilla"!==(g.appCodeName||"")||(b.Adapter.bind(c,"hashchange",function(){b.Adapter.trigger(c,"popstate")}),b.getHash()&&b.Adapter.onDomLoad(function(){b.Adapter.trigger(c,"hashchange")})))},b.options&&b.options.delayInit||b.init()}(window),b});